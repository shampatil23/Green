<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #2d5a27;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4a7c59;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2d5a27;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Connection Test</h1>
    
    <div class="test-section">
        <h2>Authentication Test</h2>
        <p>Test Firebase Authentication connection</p>
        <button onclick="testAuth()">Test Auth Connection</button>
        <div id="auth-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>Realtime Database Test</h2>
        <p>Test Firebase Realtime Database connection</p>
        <button onclick="testDatabase()">Test Database Connection</button>
        <button onclick="writeTestData()">Write Test Data</button>
        <button onclick="readTestData()">Read Test Data</button>
        <div id="db-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>Storage Test</h2>
        <p>Test Firebase Storage connection</p>
        <button onclick="testStorage()">Test Storage Connection</button>
        <div id="storage-result" class="result" style="display: none;"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getDatabase, ref, set, get, push } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import { getStorage, ref as storageRef } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBu_EJujDB_gviiZscMF1ON_URgg_7olEk",
            authDomain: "greenroot-b5258.firebaseapp.com",
            databaseURL: "https://greenroot-b5258-default-rtdb.firebaseio.com",
            projectId: "greenroot-b5258",
            storageBucket: "greenroot-b5258.firebasestorage.app",
            messagingSenderId: "73919337791",
            appId: "1:73919337791:web:aa8564ba05e34b83682f8a",
            measurementId: "G-FYDXLG646B"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);
        
        // Make available globally
        window.auth = auth;
        window.database = database;
        window.storage = storage;
        window.signInAnonymously = signInAnonymously;
        window.dbRef = ref;
        window.dbSet = set;
        window.dbGet = get;
        window.dbPush = push;
        window.storageRef = storageRef;
        
        console.log('Firebase initialized successfully');
    </script>
    
    <script>
        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.innerHTML = message;
        }
        
        async function testAuth() {
            try {
                console.log('Testing authentication...');
                const userCredential = await signInAnonymously(auth);
                showResult('auth-result', `‚úÖ Authentication successful! User ID: ${userCredential.user.uid}`);
            } catch (error) {
                console.error('Auth error:', error);
                showResult('auth-result', `‚ùå Authentication failed: ${error.message}`, true);
            }
        }
        
        async function testDatabase() {
            try {
                console.log('Testing database connection...');
                const testRef = dbRef(database, 'test/connection');
                await dbSet(testRef, {
                    message: 'Hello Firebase!',
                    timestamp: Date.now()
                });
                showResult('db-result', '‚úÖ Database connection successful!');
            } catch (error) {
                console.error('Database error:', error);
                showResult('db-result', `‚ùå Database connection failed: ${error.message}`, true);
            }
        }
        
        async function writeTestData() {
            try {
                const testData = {
                    name: 'Test User',
                    email: 'test@example.com',
                    message: 'This is a test submission',
                    timestamp: Date.now()
                };
                
                await dbPush(dbRef(database, 'submissions/test-submissions'), testData);
                showResult('db-result', '‚úÖ Test data written successfully!');
            } catch (error) {
                console.error('Write error:', error);
                showResult('db-result', `‚ùå Write failed: ${error.message}`, true);
            }
        }
        
        async function readTestData() {
            try {
                const snapshot = await dbGet(dbRef(database, 'submissions/test-submissions'));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    const count = Object.keys(data).length;
                    showResult('db-result', `‚úÖ Read successful! Found ${count} test submissions.`);
                } else {
                    showResult('db-result', 'üìù No test data found. Try writing some first.');
                }
            } catch (error) {
                console.error('Read error:', error);
                showResult('db-result', `‚ùå Read failed: ${error.message}`, true);
            }
        }
        
        function testStorage() {
            try {
                const testRef = storageRef(storage, 'test/test-file.txt');
                showResult('storage-result', '‚úÖ Storage connection successful! Reference created.');
            } catch (error) {
                console.error('Storage error:', error);
                showResult('storage-result', `‚ùå Storage connection failed: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>
